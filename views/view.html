<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>WebChat</title>
</head>
<body>
  <h3 id="user-name" data-testid="online-user"></h3>
  <input type="text" data-testid="nickname-box" id="nicknameBox">
  <button type="button" data-testid="nickname-button" id="nicknameButton">Trocar o nick</button>
  <ul id="message-list"></ul>
  <input type="text" data-testid="message-box" id="text-input"/>
  <button type="button" data-testid="send-button" id="send-button">Enviar</button>
  <script src="/socket.io/socket.io.js"></script>
  <script src="./scripts.js"></script>
  <script>
    const socket = io('http://localhost:3000');

    const sendButton = document.querySelector('#send-button');
    const nicknameButton = document.getElementById('nicknameButton');
    const nicknameBox = document.getElementById('nicknameBox');

    let randomNick = '';

    socket.on('wellcome', () => {
      const id = socket.id.substring(0,11);
      randomNick = `user-${id}`
      sessionStorage.setItem('user', randomNick);
      const userName = document.getElementById('user-name');
      userName.innerHTML = sessionStorage.getItem('user');
      });

    sendButton.addEventListener('click', () => {
      console.log('entrou no send message')
      const message = document.querySelector('#text-input').value;
      const sendMessage = {
        chatMessage: message,
        nickname: randomNick,
      }
      socket.emit('message', sendMessage)
    });
    socket.on('message', (message) => {
      const li = document.createElement('li');
      li.innerHTML = message;
      li.setAttribute('data-testid','message');
      document.getElementById('message-list').appendChild(li);
    });

    nicknameButton.addEventListener('click', () => {
      console.log('entrou no nickname')
      randomNick = nicknameBox.value;
      sessionStorage.removeItem('user');
      sessionStorage.setItem('user', randomNick);
      const userName = document.getElementById('user-name');
      userName.innerHTML = sessionStorage.getItem('user');
    })

  </script>
</body>

</html>